# GeoHub

ラスター・ベクタータイル・PMTiles対応の汎用地図ビューアー

## 特徴

- **MapLibre GL JS** ベースのモダンな地図ビューアー
- ラスタータイル・ベクタータイル（MVT）・PMTiles対応
- 属性値による色分け表示（5つのカラースキーム）
- ラベル表示機能（任意の属性を選択可能）
- 外部タイルサービス統合（地理院タイルなど）
- フィーチャー情報のインタラクティブ表示
- サーバーレスアーキテクチャ対応（S3 + CloudFront）

## 実装済み機能

### Phase 1: 基本機能 ✅
- ✅ MapLibre GL JS初期化
- ✅ 地理院タイル（標準地図）表示
- ✅ ナビゲーションコントロール
- ✅ スケール表示
- ✅ サイドパネル（開閉可能）

### Phase 2: UI強化 ✅
- ✅ 背景地図切り替えコントロール（地理院タイル3種）
- ✅ レイヤー管理システム
- ✅ レイヤーコントロールパネル（タブUI）
- ✅ レイヤー表示/非表示切り替え
- ✅ レイヤー透明度調整
- ✅ 背景地図切り替え時のレイヤー順序管理

### Phase 3: データ統合とスタイリング ✅
- ✅ カスタムタイルレイヤー読み込みダイアログ
  - ラスタータイル対応
  - ベクタータイル（MVT/PBF）対応
  - PMTilesファイル対応
- ✅ 地図クリックイベントとフィーチャー情報表示
  - プロパティテーブル表示
  - マウスホバー時のカーソル変更
- ✅ 属性値による色分け機能
  - 5つのカラースキーム（デフォルト、パステル、ビビッド、アース、オーシャン）
  - カスタムカラー設定
  - 最大20個の固有値に対応
- ✅ ラベル表示機能
  - 任意の属性をラベルとして表示
  - 白い縁取りで視認性向上
  - 重なり防止機能
- ✅ ポリゴン境界線表示

## プロジェクト構造

```
geohub/
├── index.html
├── package.json
├── vite.config.js
├── src/
│   ├── main.js                    # アプリケーションエントリーポイント
│   ├── map/
│   │   ├── mapInstance.js         # MapLibre GL JSインスタンス管理
│   │   ├── basemaps.js            # 背景地図定義（地理院タイル3種）
│   │   ├── layerManager.js        # レイヤー管理
│   │   └── clickHandler.js        # 地図クリックイベント処理
│   ├── ui/
│   │   ├── panel.js               # サイドパネル制御
│   │   ├── basemapControl.js      # 背景地図切り替えコントロール
│   │   ├── layerPanel.js          # レイヤーコントロールパネル
│   │   ├── addLayerDialog.js      # レイヤー追加ダイアログ
│   │   └── styleDialog.js         # スタイル設定ダイアログ
│   └── styles/
│       ├── main.css               # メインスタイル
│       ├── panel.css              # パネルスタイル
│       ├── basemapControl.css     # 背景地図コントロールスタイル
│       ├── layerPanel.css         # レイヤーパネルスタイル
│       ├── addLayerDialog.css     # レイヤー追加ダイアログスタイル
│       ├── styleDialog.css        # スタイル設定ダイアログスタイル
│       └── featureInfo.css        # フィーチャー情報表示スタイル
```

## セットアップ

### 必要環境

- Node.js（v18以上推奨）
- npm または yarn

### インストール

```bash
# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev

# プロダクションビルド
npm run build

# プロダクションビルドのプレビュー
npm run preview
```

アプリケーションは `http://localhost:5173` で起動します

## 使い方

### 基本操作
1. デフォルトで地理院地図（標準）が表示されます
2. 左上のナビゲーションコントロールでズーム・パン操作
3. 右上のドロップダウンで背景地図を切り替え（標準・淡色・写真）
4. 右上の📊ボタンでサイドパネルを開く
5. ×ボタンでパネルを閉じる

### レイヤー管理
1. サイドパネルの「レイヤー」タブを開く
2. 「+ レイヤーを追加」ボタンをクリック
3. タイルタイプを選択（ラスター / ベクター）
4. レイヤー名とタイルURLを入力
   - ラスタータイル: `https://example.com/tiles/{z}/{x}/{y}.png`
   - ベクタータイル: `https://example.com/tiles/{z}/{x}/{y}.pbf` + ソースレイヤー名
   - PMTiles: `https://example.com/data.pmtiles`
5. レイヤー一覧で以下の操作が可能：
   - チェックボックス: 表示/非表示
   - スライダー: 透明度調整
   - スタイルボタン: 属性値による色分け設定
   - 削除ボタン: レイヤー削除

### 属性値による色分け
1. ベクタータイルまたはPMTilesレイヤーの「スタイル」ボタンをクリック
2. データが表示されている場所にズーム
3. 色分けに使用する属性フィールドを選択
4. カラースキームを選択（デフォルト、パステル、ビビッド、アース、オーシャン）
5. 各値の色をカスタマイズ可能
6. 「適用」をクリック

### ラベル表示
1. ベクタータイルまたはPMTilesレイヤーの「ラベル表示」チェックボックスをON
2. データが表示されている場所にズーム
3. ドロップダウンから表示する属性を選択
4. 地図上にラベルが表示されます

### フィーチャー情報表示
1. ベクタータイルまたはPMTilesレイヤーを追加
2. 地図上のフィーチャーをクリック
3. サイドパネルの「データ」タブに属性情報が表示されます

## ロードマップ

### Phase 4: データ可視化（予定）
- 地物プロパティからのグラフ生成（チャート表示）
- 属性データの高度なテーブル表示
  - ソート・フィルタリング機能
  - 列の表示/非表示切り替え
- データエクスポート機能（CSV、GeoJSON）
- 統計情報の表示

### 将来の機能（検討中）
- レイヤーのインポート/エクスポート
- ブックマーク機能（地図の状態を保存）
- 測定ツール（距離・面積）
- 印刷機能
- 複数のPMTilesファイルの同時読み込み

## 技術スタック

- **フロントエンド**: Vanilla JavaScript + Vite
- **地図ライブラリ**: MapLibre GL JS
- **タイル形式**: ラスター、ベクタータイル（MVT/PBF）、PMTiles
- **ビルドツール**: Vite
- **スタイリング**: CSS（フレームワークなし）
- **依存ライブラリ**:
  - maplibre-gl: 地図レンダリング
  - pmtiles: PMTilesファイルのサポート

## 対応タイルフォーマット

### ラスタータイル
- PNG/JPG形式の画像タイル
- 例: `https://example.com/tiles/{z}/{x}/{y}.png`

### ベクタータイル（MVT）
- Mapbox Vector Tile (PBF) 形式
- 例: `https://example.com/tiles/{z}/{x}/{y}.pbf`
- source-layerの指定が必要

### PMTiles
- 単一ファイルのタイルアーカイブ
- 例: `https://example.com/data.pmtiles`
- source-layerは自動検出

## ライセンス

MIT
